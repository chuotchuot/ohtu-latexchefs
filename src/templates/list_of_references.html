<head>
    <link rel="stylesheet" href="{{ url_for('static', filename='styles/list_of_references.css') }}">
</head>

{% extends "layout.html" %}

{% block title %}
List of references | References
{% endblock %}

{% block body %}

<h2>List of references</h2>

{% if references %}
<span id="references">

<!-- Copy all references button from here -->
{% if toggle == "on" %}
<div id="all-references-in-bibtex" style="display: none; white-space: pre;">
    {% for i in references %}
{{ i.text.strip() }}
    {% endfor %}
</div>
<button class="copy-button" onclick="copyAllReferences('all-references-in-bibtex')">Copy All References</button>
<script>
    function copyAllReferences(elementId) {
        var allReferencesText = document.getElementById(elementId).innerText;
        navigator.clipboard.writeText(allReferencesText);
        copyFeedbackMessage("All references copied to clipboard.");
    }

    function copyFeedbackMessage(message) {
        const feedback = document.createElement("div");
        feedback.innerText = message;
        feedback.style.position = "fixed";
        feedback.style.bottom = "25px";
        feedback.style.right = "25px";
        feedback.style.backgroundColor = "hsl(220 22 30)";
        feedback.style.color = "white";
        feedback.style.padding = "8px 10px";
        feedback.style.borderRadius = "10px";
        feedback.style.zIndex = "100";
        feedback.style.transition = "opacity 0.3s";

        document.body.appendChild(feedback);

        setTimeout(() => {
            feedback.style.opacity = "0";
            setTimeout(() => feedback.remove(), 300);
        }, 2000);
    }
</script>
{% endif %}
<!-- to here -->

{% for i in references %}
    <!-- Placeholder starts here -->
    
        {% if toggle == "on" %}
        <!-- Copy button code from here -->
        <div id="bibtex-{{ i.id }}" class="bibtex-container">
            <!-- to here -->
        <pre>{{i.text}}</pre>
        <!-- Copy button code from here -->
    </div>
    <br/>
    <button class="copy-button" onclick="copyToClipboard('bibtex-{{ i.id }}')">Copy Reference</button>
    <script>
        function copyToClipboard(elementId) {
            var copyText = document.getElementById(elementId).innerText;
            navigator.clipboard.writeText(copyText);
            copyFeedbackMessage("Reference copied to clipboard.");
        }
    </script>
    <!-- to here -->
        {% else %}
        <div class="reference">
            {{i.title}}, {{i.author}}, {{i.year}}, {{i.publisher}}
        {% endif %}
        <form action="/edit" method="POST">
            <input type="hidden" name="id" value="{{i.id}}">
            <input type="hidden" name="confirmed" value="0">
            <input type="submit" class="button" title="Edit" value="Edit">
        </form>
        <form action="/delete" method="POST">
            <input type="hidden" name="id" value="{{i.id}}">
            <input type="hidden" name="confirmed" value="0">
            <input type="submit" class="delete button" title="Delete" value="Delete">
        </form>
        <!-- Placeholder ends here -->
    </div>
    <br>
{% endfor %}
</span>
{% else %}
<p>No references found</p>
{% endif %}

<p>
    <a href="/" class="button home">Go to front page</a>
</p>
<form action="/list_of_references" method="POST">
    {% if toggle == "on" %}
    <input type="hidden" name="state" value="off">
    {% else %}
    <input type="hidden" name="state" value="on">
    {% endif %}
    <input type="submit" class="button" value="Toggle BibTeX format">
</form>
{% endblock %}
